var EventAjaxFilters=function(){var e,t=[];return{init:function(){Common.logInfo("EventAjaxFilters.init..."),jQuery("#search_fromdate, #search_todate").each(function(){var e=jQuery(this).attr("data-date-format")||"mm/dd/yy";jQuery(this).datepicker({dateFormat:e.replace("yy","yy").replace("mm","mm").replace("dd","dd"),changeMonth:!0,changeYear:!0})}),"calendar-layout"===localStorage.getItem("layout")&&(jQuery(".event_listings").on("update_event_listings",EventAjaxFilters.actions.getEventListings),jQuery("#wpem-event-box-layout").addClass("wpem-active-layout"),localStorage.setItem("layout","box-layout")),jQuery("#wpem-event-filter-version-2-filter-action").click(function(){jQuery("#wpem-event-filter-version-2-dropdown").toggle()}),jQuery(".showing_applied_filters").hasClass("showing-applied-filters")?jQuery(".showing_applied_filters").show():jQuery(".showing_applied_filters").hide(),jQuery(this).closest("form").find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),jQuery(".wpem-search-event-more-filter").length>0&&(jQuery(".wpem-event-advance-filter").hide(),jQuery(".wpem-search-event-more-filter").on("click",function(){jQuery(".wpem-event-advance-filter").slideToggle("slow")})),jQuery.isFunction(jQuery.fn.chosen)&&(1==event_manager_ajax_filters.is_rtl&&(jQuery('select[name^="search_datetimes"]').addClass("chosen-rtl"),jQuery('select[name^="search_categories"]').addClass("chosen-rtl"),jQuery('select[name^="search_event_types"]').addClass("chosen-rtl"),jQuery('select[name^="search_ticket_prices"]').addClass("chosen-rtl")),jQuery('select[name^="search_datetimes"]').chosen({search_contains:!0}),jQuery('select[name^="search_categories"]').chosen({search_contains:!0}),jQuery('select[name^="search_event_types"]').chosen({search_contains:!0}),jQuery('select[name^="search_ticket_prices"]').chosen({search_contains:!0})),e=!!window.history&&!!window.history.pushState,jQuery(document).ready(EventAjaxFilters.actions.windowLoad),jQuery(document.body).on("click",".load_more_upcoming_events",EventAjaxFilters.actions.loadMoreUpcomingEvents),jQuery(document.body).on("click",".load_more_events",EventAjaxFilters.actions.loadMoreEvents),jQuery("#event_filters").on("click",".reset",EventAjaxFilters.actions.eventAjaxFiltersReset),jQuery("div.event_listings_main").on("click",".event-manager-pagination a",EventAjaxFilters.actions.eventPagination),jQuery(".event_listings").on("update_event_listings",EventAjaxFilters.actions.getEventListings),jQuery(".event_listings_upcoming").length>0?jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_event_types, #search_ticket_prices, .event-manager-filter").change(EventAjaxFilters.actions.getUpcomingEvents):jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_event_types, #search_ticket_prices, .event-manager-filter").change(function(){var e=jQuery(this).closest("div.event_listings");e.triggerHandler("update_event_listings",[1,!1]),EventAjaxFilters.actions.event_manager_store_state(e,1)}).on("change",function(e){EventAjaxFilters.actions.getEventListings(e),13===e.which&&jQuery(this).trigger("change")}),jQuery(".wpem-event-filter-version-2-search-btn").change(function(){var e=jQuery(this).closest("div.event_listings");e.triggerHandler("update_event_listings",[1,!1]),EventAjaxFilters.actions.event_manager_store_state(e,1)}).on("click",function(e){jQuery("#wpem-event-filter-version-2-dropdown").toggle(!1),EventAjaxFilters.actions.getEventListings(e),13===e.which&&jQuery(this).trigger("change")})},actions:{event_manager_store_state:function(t,a){Common.logInfo("EventAjaxFilters.event_manager_store_state...");var n=document.location.href.split("#")[0],i=document.location.href;if(i.match(/\/page\/\d+/)?i=i.replace(/(\/page\/)\d+/,"/page/"+a):i.endsWith("/")?i+="page/"+a:i+="/page/"+a,e){var s=jQuery(t.find(".event_filters")).serialize(),r=jQuery("div.event_listings").index(t);window.history.replaceState({id:"event_manager_state",page:a,data:s,index:r},"",n)}},windowLoad:function(e){Common.logInfo("EventAjaxFilters.actions.windowLoad..."),jQuery(".event_filters").each(function(){var e=jQuery(this).closest("div.event_listings"),t=e.find(".event_filters"),a=1,n=jQuery("div.event_listings").index(e);if(window.history.state&&window.location.hash){var i=window.history.state;i.id&&"event_manager_state"===i.id&&n==i.index&&(a=1,t.deserialize(i.data),t.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').trigger("chosen:updated"),t.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"),t.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').trigger("chosen:updated"),t.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').trigger("chosen:updated"))}e.triggerHandler("update_event_listings",[a,!1])})},eventAjaxFiltersReset:function(e){Common.logInfo("EventAjaxFilters.actions.eventAjaxFiltersReset...");var t=jQuery(this).closest("div.event_listings"),a=jQuery(this).closest("form");return a.find(':input[name="search_keywords"], :input[name="search_location"], .event-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_fromdate"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_todate"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val("").trigger("chosen:updated"),a.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),a.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),t.triggerHandler("reset"),t.triggerHandler("update_event_listings",[1,!1]),jQuery(".event_listings").on("update_event_listings",EventAjaxFilters.actions.getEventListings),EventAjaxFilters.actions.event_manager_store_state(t,1),!1},loadMoreEvents:function(e){e.preventDefault();var t=jQuery(this).closest("div.event_listings"),a=parseInt(jQuery(this).data("page")||1);return jQuery(this).parent().addClass("wpem-loading"),a+=1,jQuery(this).data("page",a),EventAjaxFilters.actions.event_manager_store_state(t,a),t.triggerHandler("update_event_listings",[a,!0,!1]),!1},eventPagination:function(e){Common.logInfo("EventAjaxFilters.actions.eventPagination...");var t=jQuery(this).closest("div.event_listings"),a=jQuery(this).data("page");EventAjaxFilters.actions.event_manager_store_state(t,a),EventAjaxFilters.actions.getEventListings(e,a,!1,!1)},getEventListings:function(e,a=1,n,i){e.preventDefault(),Common.logInfo("EventAjaxFilters.actions.getEventListings...");var s="",r=jQuery(e.currentTarget||this),o=r.find(".event_filters"),d=r.find(".showing_applied_filters"),l=r.find(".event_listings"),c=r.data("per_page"),g=r.data("orderby"),v=r.data("order"),p=r.data("featured"),h=r.data("cancelled"),m=r.data("event_online"),u=jQuery("div.event_listings").index(this);if(r.find(".load_more_events").hide(),t[u]&&t[u].abort(),n||(jQuery(l).parent().addClass("wpem-loading"),jQuery("div.event_listing, div.no_event_listings_found",l).css("visibility","hidden"),r.find(".load_more_events").data("page",a)),!0==r.data("show_filters")){if(o.find(':input[name^="search_datetimes"]').length>0)var f=o.find(':input[name^="search_datetimes"]').map(function(){return jQuery(this).val()}).get();else var y=o.find("#search_fromdate").val(),w=o.find("#search_todate").val(),f=y||w?JSON.stringify({start:y,end:w}):"",f=f?{"":f}:{};jQuery("input.date_range_picker").length>0&&jQuery("input.date_range_picker").daterangepicker();var E=o.find(':input[name^="search_categories"]').map(function(){return jQuery(this).val()}).get(),x=o.find(':input[name^="search_event_types"]').map(function(){return jQuery(this).val()}).get(),j=o.find(':input[name^="search_ticket_prices"]').map(function(){return jQuery(this).val()}).get(),k="",A="",F=o.find(':input[name="search_keywords"]'),$=o.find(':input[name="search_location"]');if(F.val()!==F.attr("placeholder")&&(k=F.val()),$.val()!==$.attr("placeholder")&&(A=$.val()),jQuery(':input[name="event_online"]').length>0){if(!0==jQuery(':input[name="event_online"]').prop("checked"))var m="true";else var m=""}s={lang:event_manager_ajax_filters.lang,search_keywords:k,search_location:A,search_datetimes:f,search_categories:E,search_event_types:x,search_ticket_prices:j,per_page:c,orderby:g,order:v,page:a,featured:p,cancelled:h,event_online:m,show_pagination:r.data("show_pagination"),form_data:o.serialize()}}else{var k=r.data("keywords"),A=r.data("location");if(o.find(':input[name^="search_datetimes"]').length>0)var f=JSON.stringify(r.data("datetimes"));var E=r.data("categories"),x=r.data("event_types"),j=r.data("ticket_prices");E&&(E=E.split(",")),x&&(x=x.split(",")),s={lang:event_manager_ajax_filters.lang,search_keywords:k,search_location:A,search_datetimes:f,search_categories:E,search_event_types:x,search_ticket_prices:j,per_page:c,orderby:g,order:v,page:a,featured:p,cancelled:h,event_online:m,show_pagination:r.data("show_pagination")}}t[u]=jQuery.ajax({type:"POST",url:event_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:s,success:function(e){if(e)try{jQuery(".no_event_listings_found").remove(),e.filter_value?jQuery(d).show().html("<span>"+e.filter_value+"</span>"+e.showing_links):jQuery(d).hide(),e.showing_applied_filters?jQuery(d).addClass("showing-applied-filters"):jQuery(d).removeClass("showing-applied-filters"),e.html&&(n&&i?(jQuery(l).prepend(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):n?(jQuery(l).append(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):jQuery(l).html(e.html)),!0==r.data("show_pagination")?e.pagination&&jQuery(".event-manager-pagination").html(e.pagination):(localStorage.setItem("total_event_page",e.max_num_pages),localStorage.setItem("current_event_page",a),!e.found_events||e.max_num_pages<=a?r.find(".load_more_events:not(.load_previous)").hide():i||r.find(".load_more_events").show(),r.find(".load_more_events_loader").removeClass("wpem-loading"),jQuery("li.event_listing",l).css("visibility","visible")),jQuery(l).parent().removeClass("wpem-loading"),r.triggerHandler("updated_results",e)}catch(t){window.console&&Common.logError(t)}},error:function(e,t,a){window.console&&"abort"!==t&&Common.logError(t+": "+a)},statusCode:{404:function(){window.console&&Common.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),e.preventDefault()},loadMoreUpcomingEvents:function(e){if(jQuery("#upcoming_event_listing").length>0){e.preventDefault(),jQuery(this).parent().addClass("wpem-loading");var t=jQuery("#search_keywords").val(),a=jQuery("#search_location").val(),n=jQuery("#search_categories").val(),i=jQuery("#search_event_types").val(),s=jQuery("#search_datetimes").val(),r=jQuery("#upcoming_event_listing").data("order"),o=jQuery("#upcoming_event_listing").data("orderby"),d=jQuery(".load_more_upcoming_events").attr("data-page"),l=jQuery("#per-page-settings").data("per-page");jQuery.ajax({type:"POST",url:event_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_upcoming_listings"),data:{action:"get_upcoming_listings",search_keywords:t,search_location:a,search_datetimes:s,search_categories:n,search_event_types:i,order:r,orderby:o,value:d,per_page:l},success:function(e){if(target.find(".load_more_events_loader").removeClass("wpem-loading"),e.success){jQuery(".event_listings").append(e.data.events_html);var t=parseInt(d)+1;jQuery("#load_more_events").attr("data-page",t),!0===e.data.no_more_events&&jQuery("#load_more_events").hide()}else console.error("Failed to load events:",e.data.error),"No more events found."===e.data.error&&jQuery("#load_more_events").hide()},error:function(e,t,a){console.error("AJAX Error:",t,a)}})}},getUpcomingEvents:function(e){e.preventDefault();var t=jQuery("#search_keywords").val(),a=jQuery("#search_location").val(),n=jQuery("#search_categories").val(),i=jQuery("#search_event_types").val(),s=jQuery("#search_datetimes").val(),r=jQuery("#upcoming_event_listing").data("order"),o=jQuery("#upcoming_event_listing").data("orderby"),d=jQuery("#upcoming_event_listing").attr("data-page"),l=jQuery("#per-page-settings").data("per-page");jQuery.ajax({type:"POST",url:event_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_upcoming_listings"),data:{action:"get_upcoming_listings",search_keywords:t,search_location:a,search_datetimes:s,search_categories:n,search_event_types:i,order:r,orderby:o,value:d,per_page:l},success:function(e){if(e.success){jQuery("#event-listing-view").html(e.data.events_html),jQuery("#event-listing-view").data("locked",!0);var t=parseInt(d)+1;jQuery("#load_more_events").attr("data-page",t),!0===e.data.no_more_events&&jQuery("#load_more_events").hide()}else console.error("Failed to load events:",e.data.error),jQuery("#load_more_events").hide()},error:function(e,t,a){console.error("AJAX Error:",t,a)}})}}}};EventAjaxFilters=EventAjaxFilters(),jQuery(document).ready(function(e){EventAjaxFilters.init()});
var EventAjaxFilters=function(){var e,t=[];return{init:function(){Common.logInfo("EventAjaxFilters.init..."),jQuery.isFunction(jQuery.fn.chosen)&&(1==event_manager_ajax_filters.is_rtl&&(jQuery('select[name^="search_datetimes"]').addClass("chosen-rtl"),jQuery('select[name^="search_categories"]').addClass("chosen-rtl"),jQuery('select[name^="search_event_types"]').addClass("chosen-rtl"),jQuery('select[name^="search_ticket_prices"]').addClass("chosen-rtl")),jQuery('select[name^="search_datetimes"]').chosen({search_contains:!0}),jQuery('select[name^="search_categories"]').chosen({search_contains:!0}),jQuery('select[name^="search_event_types"]').chosen({search_contains:!0}),jQuery('select[name^="search_ticket_prices"]').chosen({search_contains:!0})),e=window.history&&window.history.pushState?!0:!1,jQuery(window).on("load",EventAjaxFilters.actions.windowLoad),jQuery(document.body).on("click",".load_more_events",EventAjaxFilters.actions.loadMoreEvents),jQuery(".event_filters").on("click",".reset",EventAjaxFilters.actions.eventAjaxFiltersReset),jQuery("div.event_listings").on("click",".event-manager-pagination a",EventAjaxFilters.actions.eventPagination),jQuery(".event_listings").on("update_event_listings",EventAjaxFilters.actions.getEventListings),jQuery("#search_keywords, #search_location, #search_datetimes, #search_categories, #search_event_types, #search_ticket_prices, .event-manager-filter").change(function(){var e=jQuery(this).closest("div.event_listings");e.triggerHandler("update_event_listings",[1,!1]),EventAjaxFilters.event_manager_store_state(e,1)}).on("keyup",function(e){13===e.which&&jQuery(this).trigger("change")})},event_manager_store_state:function(t,n){Common.logInfo("EventAjaxFilters.event_manager_store_state...");var a=document.location.href.split("#")[0];if(e){var i=t.find(".event_filters"),r=jQuery(i).serialize(),s=jQuery("div.event_listings").index(t);window.history.replaceState({id:"event_manager_state",page:n,data:r,index:s},"",a+"#events")}},actions:{windowLoad:function(e){Common.logInfo("EventAjaxFilters.actions.windowLoad..."),jQuery(".event_filters").each(function(){var e=jQuery(this).closest("div.event_listings"),t=e.find(".event_filters"),n=1,a=jQuery("div.event_listings").index(e);if(window.history.state&&window.location.hash){var i=window.history.state;i.id&&"event_manager_state"===i.id&&a==i.index&&(n=i.page,t.deserialize(i.data),t.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').trigger("chosen:updated"),t.find(':input[name^="search_categories"]').not(':input[type="hidden"]').trigger("chosen:updated"),t.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').trigger("chosen:updated"),t.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').trigger("chosen:updated"))}e.triggerHandler("update_event_listings",[n,!1])}),e.preventDefault()},eventAjaxFiltersReset:function(e){Common.logInfo("EventAjaxFilters.actions.eventAjaxFiltersReset...");var t=jQuery(this).closest("div.event_listings"),n=jQuery(this).closest("form");return n.find(':input[name="search_keywords"], :input[name="search_location"], .event-manager-filter').not(':input[type="hidden"]').val("").trigger("chosen:updated"),n.find(':input[name^="search_datetimes"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),n.find(':input[name^="search_categories"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),n.find(':input[name^="search_event_types"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),n.find(':input[name^="search_ticket_prices"]').not(':input[type="hidden"]').val(0).trigger("chosen:updated"),t.triggerHandler("reset"),t.triggerHandler("update_event_listings",[1,!1]),EventAjaxFilters.event_manager_store_state(t,1),!1},loadMoreEvents:function(e){Common.logInfo("EventAjaxFilters.actions.loadMoreEvents...");var t=jQuery(this).closest("div.event_listings"),n=parseInt(jQuery(this).data("page")||1),a=!1;return jQuery(this).addClass("loading"),jQuery(this).is(".load_previous")?(n-=1,a=!0,1===n?jQuery(this).remove():jQuery(this).data("page",n)):(n+=1,jQuery(this).data("page",n),EventAjaxFilters.event_manager_store_state(t,n)),t.triggerHandler("update_event_listings",[n,!0,a]),!1},eventPagination:function(e){Common.logInfo("EventAjaxFilters.actions.eventPagination...");var t=jQuery(this).closest("div.event_listings"),n=jQuery(this).data("page");return EventAjaxFilters.event_manager_store_state(t,n),t.triggerHandler("update_event_listings",[n,!1]),jQuery("body, html").animate({scrollTop:t.offset().top},600),!1},getEventListings:function(e,n,a,i){Common.logInfo("EventAjaxFilters.actions.getEventListings...");var r="",s=jQuery(this),o=s.find(".event_filters"),d=s.find(".showing_applied_filters"),l=s.find(".event_listings"),c=s.data("per_page"),_=s.data("orderby"),g=s.data("order"),u=s.data("featured"),v=s.data("cancelled"),p=jQuery("div.event_listings").index(this);if(!(0>p)){if(t[p]&&t[p].abort(),a||(jQuery(l).addClass("loading"),jQuery("li.event_listing, li.no_event_listings_found",l).css("visibility","hidden"),n>1&&1!=s.data("show_pagination")?jQuery(l).before('<a class="load_more_events load_previous" href="#"><strong>'+event_manager_ajax_filters.i18n_load_prev_listings+"</strong></a>"):s.find(".load_previous").remove(),s.find(".load_more_events").data("page",n)),1==s.data("show_filters")){var h=o.find(':input[name^="search_datetimes"]').map(function(){return jQuery(this).val()}).get(),m=o.find(':input[name^="search_categories"]').map(function(){return jQuery(this).val()}).get(),y=o.find(':input[name^="search_event_types"]').map(function(){return jQuery(this).val()}).get(),j=o.find(':input[name^="search_ticket_prices"]').map(function(){return jQuery(this).val()}).get(),f="",Q="",w=o.find(':input[name="search_keywords"]'),x=o.find(':input[name="search_location"]');w.val()!==w.attr("placeholder")&&(f=w.val()),x.val()!==x.attr("placeholder")&&(Q=x.val()),r={lang:event_manager_ajax_filters.lang,search_keywords:f,search_location:Q,search_datetimes:h,search_categories:m,search_event_types:y,search_ticket_prices:j,per_page:c,orderby:_,order:g,page:n,featured:u,cancelled:v,show_pagination:s.data("show_pagination"),form_data:o.serialize()}}else{var f=s.data("keywords"),Q=s.data("location"),h=s.data("datetimes"),m=s.data("categories"),y=s.data("event_types"),j=s.data("ticket_prices");m&&(m=m.split(",")),r={lang:event_manager_ajax_filters.lang,search_keywords:f,search_location:Q,search_datetimes:h,search_categories:m,search_event_types:y,search_ticket_prices:j,per_page:c,orderby:_,order:g,page:n,featured:u,cancelled:v,show_pagination:s.data("show_pagination")}}t[p]=jQuery.ajax({type:"POST",url:event_manager_ajax_filters.ajax_url.toString().replace("%%endpoint%%","get_listings"),data:r,success:function(e){if(e)try{e.filter_value?jQuery(d).show().html("<span>"+e.filter_value+"</span>"+e.showing_links):jQuery(d).hide(),e.showing_applied_filters?jQuery(d).addClass("showing-applied-filters"):jQuery(d).removeClass("showing-applied-filters"),e.html&&(a&&i?(jQuery(l).prepend(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):a?(jQuery(l).append(e.html),jQuery("div.google-map-loadmore").length>0&&jQuery("div .google-map-loadmore").not("div.google-map-loadmore:first").remove()):jQuery(l).html(e.html)),1==s.data("show_pagination")?(s.find(".event-manager-pagination").remove(),e.pagination&&s.append(e.pagination)):(!e.found_events||e.max_num_pages<=n?jQuery(".load_more_events:not(.load_previous)",s).hide():i||jQuery(".load_more_events",s).show(),jQuery(".load_more_events",s).removeClass("loading"),jQuery("li.event_listing",l).css("visibility","visible")),jQuery(l).removeClass("loading"),s.triggerHandler("updated_results",e)}catch(t){window.console&&Common.logError(t)}},error:function(e,t,n){window.console&&"abort"!==t&&Common.logError(t+": "+n)},statusCode:{404:function(){window.console&&Common.logError("Error 404: Ajax Endpoint cannot be reached. Go to Settings > Permalinks and save to resolve.")}}}),e.preventDefault()}}}}};EventAjaxFilters=EventAjaxFilters(),jQuery(document).ready(function(e){EventAjaxFilters.init()});